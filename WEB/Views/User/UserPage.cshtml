@using AppTest.Models.Entities
@{
    Layout = "~/Views/Shared/MyLayout.cshtml";
    UserEntity Owner = ViewBag.Owner;
    UserEntity MyUser = ViewBag.MyUser;
}
<HeadContent>
    <script src="~/js/UserPage.js" asp-append-version="true"></script>
    <link rel="stylesheet" href="~/css/UserPage.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/CommentSection.css" asp-append-version="true" />
    
</HeadContent>

<body>
    <div class="body-block">
        <div class="user-information-div">
            <div class="all-information-div">
                <div class="owner-name-div">
                    @if (Owner.IsVerified)
                    {
                        <label>@Owner.Login ☑</label>
                    }
                    else
                    {
                        <label>@Owner.Login</label>
                    }
                </div>
                <div class="right-div">
                    <div class="center-div">
                        <a href="/UserPage/@Owner.Login/Friends">Подписки</a>
                        @if (Owner.Login != User.Identity.Name)
                        {
                            if (MyUser.Friends.Select(c=>c.Login).Contains(Owner.Login))
                            {
                                <a href="">Вы уже отслеживаете этого пользователя</a>
                                <form asp-action="Unfriend" asp-controller="User" method="post">
                                    <input type="hidden" name="User1" value="@User.Identity.Name"></input>
                                    <input type="hidden" name="User2" value="@Owner.Login"></input>
                                    <input type="submit" value="Перестать отслеживать пользователя"></input>
                                </form>
                            }
                            else
                            {
                                <form asp-action="AddFriend" asp-controller="User" method="post">
                                    <input type="hidden" name="User1" value="@User.Identity.Name"></input>
                                    <input type="hidden" name="User2" value="@Owner.Login"></input>
                                    <input type="submit" value="Отслеживать пользователя"></input>
                                    </form>
                            }

                                
                            }

                        <a href="/UserPage/@Owner.Login/Tests">Информация об анкетах</a>
                    </div>
                </div>
            </div>

        </div>
        <hr/>
        <div class="post-sectionDiv">
            @if (User.Identity.Name == Owner.Login)
            {
                <div class="add-post-section">
                    <form asp-action="AddPost" asp-controller="Home" method="post">
                        <div class="post-add-div">
                            <input type="text" id="postTitleInput" name="PostTitle"   placeholder="Заголовок Поста"></input>
                            <textarea id="postTextInput" name="PostText" placeholder="Поделитесь своими мыслями"></textarea>
                            <div class="post-add-button">
                               <div></div>
                                <input type="submit" value="Опубликовать"></input>
                            </div>
                        </div>
                    </form>
                </div>
            }

            @{
                int fl = 0;
            }
            <div class="post-section-div">
                @if(Owner.Page is not null)
                {
                    @foreach(var c in Owner.Page.Posts.OrderByDescending(c=>c.time))
                    {
                        fl += 1;
                        <div class="post-div">
                            <div class="post-information">
                                <div class="post-header">
                                    <p>@Owner.Login</p>
                                    <div class="post-buttontime">
                                        <p>@c.time</p>
                                        <div class="extend-button">
                                            <ul>
                                                <li>
                                                    <span>•••</span>
                                                    <ul>
                                                        <li>
                                                            <input type="button" class="ReportButtonPost" value = "Пожаловаться" onclick="ShowSubmitPost(@c.Id)"></input>
                                                        </li>
                                                        @if (Owner.Login == User.Identity.Name)
                                                        {
                                                            <li>
                                                                <form asp-action="DeletePost" asp-controller="Home" method="post">
                                                                    <input type="submit" value="Удалить"/>
                                                                    <input type="hidden" name="PostID" value="@c.Id"/>
                                                                    <input type="hidden" name="Login" value="@Owner.Login"></input>

                                                                </form>
                                                            </li>
                                                        }
                                                       
                                                    </ul>
                                                </li>


                                            </ul>
                                        </div>
                                    </div>
                                
                                </div>

                                <div class="post-text">
                                    <p>@c.Title</p>
                                    <p>@c.Text</p>
                                    @foreach(var q in c.Images)
                                    {
                                        <img src="@q.src"></img>
                                    }
                                </div>
                            </div>

                            <hr/>
                            <div class="comment-section">
                                @foreach(var q in c.Comments)
                                {
                                    <div class="comment-div">
                                        <div class="comment-header">
                                            @if (q.User.IsVerified)
                                            {
                                                <a href="/UserPage/@q.User.Login"><p>@q.User.Login ☑</p></a>

                                            }
                                            else
                                            {
                                                <a href="/UserPage/@q.User.Login"><p>@q.User.Login </p></a>
                                            }

                                            <div class="post-buttontime">
                                                <p>@q.Time</p>
                                                <div class="extend-button">
                                                    <ul>
                                                        <li>
                                                            <span>•••</span>
                                                            <ul>
                                                                <li>
                                                                    <input type="button" class="ReportButtonPost" value="Пожаловаться" onclick="ShowSubmitComment(@q.Id)"></input>
                                                                </li>
                                                                @if (Owner.Login == User.Identity.Name || q.User.Login==User.Identity.Name)
                                                                {
                                                                    <li>
                                                                        <form asp-action="DeleteComment" asp-controller="Home" method="post">
                                                                            <input type="submit" value="Удалить" />
                                                                            <input type="hidden" name="CommentID" value="@q.Id" />
                                                                            <input type="hidden" name="Login" value="@Owner.Login"></input>

                                                                        </form>
                                                                    </li>
                                                                }
                                                               
                                                            </ul>
                                                        </li>


                                                    </ul>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="comment-text">
                                            @q.Text

                                            @foreach(var i in q.Images)
                                            {
                                                <img src="@i.src"></img>
                                            }
                                        </div>


                                    </div>
                                }
                            </div>
                            <hr/>
                            <div class="comment-add-section">
                                <form asp-action="AddComment" asp-controller="Home" method="post">
                                    <textarea placeholder="Введите свой комментарий" name="PostText"></textarea>
                                    <div class="comment-add-buttons">
                                        <div></div>
                                        <input type="submit" value="Опубликовать"></input>
                                    </div>
                                    <input type="hidden" name="PostID" value="@c.Id"></input>
                                    <input type="hidden" name="Owner" value="@Owner.Login"></input>
                                </form>
                                


                            </div>

                        </div>







                    }
                }
            </div>
        </div>


    </div>
</body>